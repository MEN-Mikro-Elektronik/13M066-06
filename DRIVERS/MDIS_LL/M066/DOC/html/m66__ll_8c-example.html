<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - M66 MDIS Driver - Example Documentation</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;"></a>
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">M66 MDIS Driver &nbsp; </h1>
	<h3>Example Documentation</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>m66_ll.c</h1><div class="fragment"><pre><span class="comment">/*********************  P r o g r a m  -  M o d u l e **********************/</span>
<span class="comment">/*-------------------------------[ History ]---------------------------------</span>
<span class="comment"> *</span>
<span class="comment"> * $Log: m66_ll.c,v $</span>
<span class="comment"> * Revision 1.3  2008/09/17 17:59:20  CKauntz</span>
<span class="comment"> * R: No doxygen documentation</span>
<span class="comment"> * M: Changed comments to doxygen documentations</span>
<span class="comment"> *</span>
<span class="comment"> * Revision 1.2  1999/03/19 11:50:09  Franke</span>
<span class="comment"> * changed -  MDIS 4.1 debug handling</span>
<span class="comment"> *</span>
<span class="comment"> * Revision 1.1  1998/03/03 11:59:50  franke</span>
<span class="comment"> * initial</span>
<span class="comment"> *</span>
<span class="comment"> *---------------------------------------------------------------------------</span>
<span class="comment"> * (c) Copyright 1998..2008 by MEN mikro elektronik GmbH, Nuernberg, Germany</span>
<span class="comment"> ****************************************************************************/</span>

<span class="keyword">static</span> <span class="keywordtype">char</span> *RCSid=<span class="stringliteral">"$Id: m66_ll.c,v 1.3 2008/09/17 17:59:20 CKauntz Exp $\n"</span>;

<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="preprocessor">#include &lt;MEN/men_typs.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/usr_oss.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/mdis_api.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/mdis_err.h&gt;</span>
<span class="preprocessor">#include &lt;MEN/mbuf.h&gt;</span>       <span class="comment">/* buffer lib functions and types */</span>
<span class="preprocessor">#include &lt;MEN/maccess.h&gt;</span>    <span class="comment">/* hw access macros and types     */</span>

<span class="preprocessor">#include &lt;MEN/oss.h&gt;</span>    <span class="comment">/* operating system services */</span>
<span class="preprocessor">#include &lt;MEN/desc.h&gt;</span>   <span class="comment">/* descriptor manager        */</span>
<span class="preprocessor">#include &lt;MEN/ll_defs.h&gt;</span>    <span class="comment">/* low level driver definitions   */</span>
<span class="preprocessor">#include &lt;MEN/ll_entry.h&gt;</span>   <span class="comment">/* low level driver entry struct  */</span>

<span class="preprocessor">#define _LL_DRV_</span>
<span class="preprocessor"></span><span class="preprocessor">#define M_ERRSTRING</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;MEN/dbg.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="m66__drv_8h.html">MEN/m66_drv.h</a>&gt;</span>

<span class="comment">/*-----------------------------------------+</span>
<span class="comment">|  TYPEDEFS                                |</span>
<span class="comment">+------------------------------------------*/</span>

<span class="comment">/*-----------------------------------------+</span>
<span class="comment">|  DEFINES &amp; CONST                         |</span>
<span class="comment">+------------------------------------------*/</span>
<span class="keyword">static</span> <span class="keyword">const</span> int32 OFF = 0;
<span class="keyword">static</span> <span class="keyword">const</span> int32 ON  = 1;

<span class="keyword">static</span> <span class="keyword">const</span> int32 T_OK = 0;
<span class="keyword">static</span> <span class="keyword">const</span> int32 T_ERROR = 1;

<span class="keyword">static</span> <span class="keyword">const</span> int32 CH_DUMMY  = 0;
<span class="keyword">static</span> <span class="keyword">const</span> int32 CH_0      = 0;
<span class="keyword">static</span> <span class="keyword">const</span> int32 CH_31     = 31;

<span class="comment">/*-----------------------------------------+</span>
<span class="comment">|  GLOBALS                                 |</span>
<span class="comment">+------------------------------------------*/</span>

<span class="comment">/*-----------------------------------------+</span>
<span class="comment">|  STATICS                                 |</span>
<span class="comment">+------------------------------------------*/</span>

<span class="comment">/*-----------------------------------------+</span>
<span class="comment">|  PROTOTYPES                              |</span>
<span class="comment">+------------------------------------------*/</span>

<span class="keywordtype">void</span> <a name="a3"></a><a class="code" href="m66__ll_8c.html#a10">m66_ll</a>( <span class="keywordtype">void</span> );

<span class="preprocessor">#ifdef VXWORKS</span>
<span class="preprocessor"></span><span class="preprocessor">    #define  OS_HDL             NULL   </span><span class="comment">/* OS Handle not used */</span>
<span class="preprocessor">    #define  DEV_SEM_NULL_HDL   NULL   </span><span class="comment">/* Device semaphore handle only used by MDIS Kernel */</span>
<span class="preprocessor">    #define  IRQ_NULL_HDL       NULL   </span><span class="comment">/* no irq's used in this example */</span>
    <span class="keyword">extern</span>   DESC_SPEC          M66_1; <span class="comment">/* low level descriptor specifier  */</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="comment">/*</span>
<span class="comment">    *  OS like OS9, HPRT, LYNX</span>
<span class="comment">    */</span>
    <span class="keywordtype">void</span> <a name="a4"></a><a class="code" href="m66__ll_8c.html#a11">main</a>( <span class="keywordtype">void</span> )
    {
        <a class="code" href="m66__ll_8c.html#a10">m66_ll</a>();
    }

<span class="preprocessor">#endif</span><span class="comment">/*VXWORKS*/</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> <a name="a5"></a><a class="code" href="m66__ll_8c.html#a12">delay</a>()
{
<span class="keyword">volatile</span> <span class="keywordtype">int</span> i,j;
    <span class="keywordflow">for</span>( i=0;i&lt;1000;i++)
        <span class="keywordflow">for</span>( j=0;j&lt;1000;j++);
}<span class="comment">/*delay*/</span>

<span class="comment">/******************************** m66_ll **********************************/</span>
<span class="keywordtype">void</span> <a class="code" href="m66__ll_8c.html#a10">m66_ll</a>( <span class="keywordtype">void</span> )
{
int32      ret;
MACCESS    ma[1];                <span class="comment">/* access handle */</span>
LL_HANDLE  *llDrvHdl;            <span class="comment">/* ll drv handle */</span>
int32      value;                <span class="comment">/* value to write/read */</span>
u_int8     buffer[<a class="code" href="m66__drv_8h.html#a4">M66_MAX_CH</a>];   <span class="comment">/* block write/read buffer */</span>
int32      nbrOfBytes;           <span class="comment">/* number of written/read bytes */</span>
<span class="keywordtype">int</span>        loopy;

    printf(<span class="stringliteral">"m66_ll - started ...\n"</span>);

<span class="preprocessor">#ifdef VXWORKS</span>
<span class="preprocessor"></span>    OSS_Init();
<span class="preprocessor">#endif</span><span class="comment">/*VXWORKS*/</span>

    <span class="comment">/* set the base address of the device */</span>
    ma[0] = (MACCESS) 0x88aaaa00; <span class="comment">/* VME A08/D16 range */</span>

    <span class="comment">/* gets the ll-drv handle, decodes descriptor, init HW */</span>
    ret = <a name="a6"></a><a class="code" href="m66__drv_8c.html#a36">M66_Init</a>( &amp;M66_1,                   <span class="comment">/* LL-Descriptor handle */</span>
                    OS_HDL,                   <span class="comment">/* operating system handle */</span>
                    ma,                       <span class="comment">/* access handle */</span>
                    DEV_SEM_NULL_HDL,         <span class="comment">/* device semaphore handle -  not used in this example */</span>
                    IRQ_NULL_HDL,             <span class="comment">/* irq handle - not used in this example */</span>
                    &amp;llDrvHdl );              <span class="comment">/* pointer to ll drv handle */</span>
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_Init()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>

    <span class="comment">/* switch channel 0 on */</span>
    value = 1;
    ret = <a name="a7"></a><a class="code" href="m66__drv_8c.html#a39">M66_Write</a>( llDrvHdl,
                     CH_0,
                     value );
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_Write()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>

    <a class="code" href="m66__ll_8c.html#a12">delay</a>();

    <span class="comment">/* read channel 31 */</span>
    ret = <a name="a8"></a><a class="code" href="m66__drv_8c.html#a38">M66_Read</a>( llDrvHdl,
                    CH_31,
                    (u_int32*) &amp;value );
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_Read()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>

    <a class="code" href="m66__ll_8c.html#a12">delay</a>();

    <span class="comment">/* switch output pattern */</span>
    <span class="keywordflow">for</span>( loopy=0; loopy&lt;<a class="code" href="m66__drv_8h.html#a4">M66_MAX_CH</a>; loopy++ ) buffer[loopy]= loopy &amp; 1; <span class="comment">/* 010101... pattern */</span>
    ret = <a name="a9"></a><a class="code" href="m66__drv_8c.html#a43">M66_BlockWrite</a>( llDrvHdl,
                          CH_DUMMY,
                          buffer,
                          M66_MAX_CH,
                          &amp;nbrOfBytes );
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_BlockWrite()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>

    <a class="code" href="m66__ll_8c.html#a12">delay</a>();

    <span class="comment">/* read back pattern */</span>
    ret = <a name="a10"></a><a class="code" href="m66__drv_8c.html#a42">M66_BlockRead</a>( llDrvHdl,
                         CH_DUMMY,
                         buffer,
                         M66_MAX_CH,
                         &amp;nbrOfBytes );
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_BlockRead()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>

    <span class="comment">/* setstat enable debug - task level 1 */</span>
    ret = <a name="a11"></a><a class="code" href="m66__drv_8c.html#a40">M66_SetStat</a>( llDrvHdl,
                       M_LL_DEBUG_LEVEL,
                       CH_DUMMY,
                       DBG_NORM |DBG_LEV1 );
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_SetStat()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>

    <span class="comment">/* getstat ID_CHECK at M66_Init() */</span>
    ret = <a name="a12"></a><a class="code" href="m66__drv_8c.html#a41">M66_GetStat</a>( llDrvHdl,
                       M_LL_ID_CHECK,
                       CH_DUMMY,
                       &amp;value );
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_GetStat()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>

    <span class="comment">/* deinitialize the M66 and free the low level handle */</span>
    ret = <a name="a13"></a><a class="code" href="m66__drv_8c.html#a37">M66_Exit</a>( &amp;llDrvHdl );
    <span class="keywordflow">if</span>( ret != 0 )
    {
        printf(<span class="stringliteral">"*** ERROR - M66_Exit()"</span>);
        <span class="keywordflow">goto</span> LL_EXAMPLE_ERROR;
    }<span class="comment">/*if*/</span>


<span class="preprocessor">#ifdef VXWORKS</span>
<span class="preprocessor"></span>    OSS_Exit();
<span class="preprocessor">#endif</span><span class="comment">/*VXWORKS*/</span>
    printf(<span class="stringliteral">"m66_ll - finished - OK\n"</span>);
    <span class="keywordflow">return</span>;

    <span class="comment">/* jump to if error occurred */</span>
LL_EXAMPLE_ERROR:
    printf(<span class="stringliteral">" with error 0x%04x ***\n"</span>, (<span class="keywordtype">int</span>) ret );

<span class="preprocessor">#ifdef M_ERRSTRING</span>
<span class="preprocessor"></span>    printf(<span class="stringliteral">"*** %s ***\n"</span>,M_errstring( ret ) );
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef VXWORKS</span>
<span class="preprocessor"></span>    OSS_Exit();
<span class="preprocessor">#endif</span><span class="comment">/*VXWORKS*/</span>

}<span class="comment">/*m66_ll*/</span>

</pre></div> 
	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for M66 MDIS Driver using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2012 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

